{% extends "base.html" %}

{% block title %}Products - Inventory Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Products</h1>
    <div style="display: flex; gap: 12px;">
        <a href="{{ url_for('export_products') }}" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Export CSV
        </a>
        {% if current_user.is_admin() %}
        <a href="{{ url_for('import_products') }}" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17,8 12,3 7,8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            Import CSV
        </a>
        {% endif %}
        <a href="{{ url_for('add_product') }}" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Product
        </a>
    </div>
</div>

<form method="GET" action="{{ url_for('products') }}" class="filters-bar">
    <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" name="search" class="form-control" placeholder="Search by name or SKU..." value="{{ search }}">
    </div>
    
    <select name="category" class="form-control filter-select">
        <option value="">All Categories</option>
        {% for category in categories %}
        <option value="{{ category.id }}" {% if category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
    </select>
    
    <select name="sort" class="form-control filter-select">
        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Sort by Name</option>
        <option value="quantity" {% if sort_by == 'quantity' %}selected{% endif %}>Sort by Quantity</option>
        <option value="selling_price" {% if sort_by == 'selling_price' %}selected{% endif %}>Sort by Price</option>
        <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>Sort by Date</option>
    </select>
    
    <select name="order" class="form-control filter-select">
        <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
        <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
    </select>
    
    <button type="submit" class="btn btn-secondary">Filter</button>
    
    {% if search or category_id %}
    <a href="{{ url_for('products') }}" class="btn btn-secondary">Clear</a>
    {% endif %}
</form>

<div class="card">
    <div class="table-container">
        {% if products %}
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>SKU</th>
                    <th>Category</th>
                    <th>Purchase Price</th>
                    <th>Selling Price</th>
                    <th>Stock</th>
                    <th>Supplier</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>
                        <strong>{{ product.name }}</strong>
                        {% if product.description %}
                        <br><small class="text-muted">{{ product.description[:50] }}{% if product.description|length > 50 %}...{% endif %}</small>
                        {% endif %}
                    </td>
                    <td><span class="badge badge-secondary">{{ product.sku }}</span></td>
                    <td>
                        {% if product.category %}
                        {{ product.category.name }}
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>${{ "%.2f"|format(product.purchase_price) }}</td>
                    <td>${{ "%.2f"|format(product.selling_price) }}</td>
                    <td>
                        {% if product.quantity == 0 %}
                        <span class="badge badge-danger">Out of Stock</span>
                        {% elif product.is_low_stock() %}
                        <span class="badge badge-warning">{{ product.quantity }} (Low)</span>
                        {% else %}
                        <span class="badge badge-success">{{ product.quantity }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if product.supplier %}
                        {{ product.supplier.name }}
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="table-actions">
                            <a href="{{ url_for('update_stock', id=product.id) }}" class="btn btn-success btn-sm" title="Update Stock">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                                </svg>
                            </a>
                            <a href="{{ url_for('edit_product', id=product.id) }}" class="btn btn-secondary btn-sm" title="Edit">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                            </a>
                            {% if current_user.is_admin() %}
                            <form action="{{ url_for('delete_product', id=product.id) }}" method="POST" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                <button type="submit" class="btn btn-danger btn-sm" title="Delete">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                <line x1="3" y1="6" x2="21" y2="6"/>
                <path d="M16 10a4 4 0 0 1-8 0"/>
            </svg>
            <h3>No products found</h3>
            <p>{% if search or category_id %}Try adjusting your filters or {% endif %}<a href="{{ url_for('add_product') }}">add your first product</a>.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
