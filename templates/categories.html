{% extends "base.html" %}

{% block title %}Categories - Inventory Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Categories</h1>
</div>

<div class="grid-2">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">All Categories</h2>
        </div>
        <div class="table-container">
            {% if categories %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Products</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                    <tr>
                        <td><strong>{{ category.name }}</strong></td>
                        <td>{{ category.description or '-' }}</td>
                        <td><span class="badge badge-secondary">{{ category.products.count() }}</span></td>
                        <td>
                            <div class="table-actions">
                                <button type="button" class="btn btn-secondary btn-sm" onclick="editCategory({{ category.id }}, '{{ category.name }}', '{{ category.description or '' }}')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                {% if current_user.is_admin() %}
                                <form action="{{ url_for('delete_category', id=category.id) }}" method="POST" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this category?');">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                            <polyline points="3,6 5,6 21,6"/>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        </svg>
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                    <line x1="7" y1="7" x2="7.01" y2="7"/>
                </svg>
                <h3>No categories yet</h3>
                <p>Add your first category using the form.</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2 class="card-title" id="formTitle">Add Category</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('add_category') }}" id="categoryForm">
                <div class="form-group">
                    <label class="form-label required" for="name">Category Name</label>
                    <input type="text" id="name" name="name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="description">Description</label>
                    <textarea id="description" name="description" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Category
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn" style="display: none;" onclick="resetForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editCategory(id, name, description) {
    document.getElementById('formTitle').textContent = 'Edit Category';
    document.getElementById('name').value = name;
    document.getElementById('description').value = description;
    document.getElementById('categoryForm').action = '/categories/' + id + '/edit';
    document.getElementById('submitBtn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg> Save Changes';
    document.getElementById('cancelBtn').style.display = 'inline-flex';
}

function resetForm() {
    document.getElementById('formTitle').textContent = 'Add Category';
    document.getElementById('name').value = '';
    document.getElementById('description').value = '';
    document.getElementById('categoryForm').action = '{{ url_for("add_category") }}';
    document.getElementById('submitBtn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Category';
    document.getElementById('cancelBtn').style.display = 'none';
}
</script>
{% endblock %}
